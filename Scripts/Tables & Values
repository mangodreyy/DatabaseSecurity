-- TABLES -- 
-- Department Table
CREATE TABLE Department (
	DepartmentID VARCHAR(10) NOT NULL PRIMARY KEY,
	DepartmentName VARCHAR(100) UNIQUE NOT NULL
);
GO

INSERT INTO Department VALUES
('DBA', 'Database Administration'),
('SDEV', 'Software Development'),
('ACC', 'Accounting'),
('HR', 'Human Resources'),
('MKT', 'Marketing Development'),
('AGENT','Agents');
GO

-- Employee Table
CREATE TABLE Employees (
	EmployeeID INT IDENTITY(1,1) NOT NULL PRIMARY KEY, 
	DepartmentID VARCHAR(10) FOREIGN KEY REFERENCES Department(DepartmentID),
	Status NVARCHAR(20) DEFAULT 'ACTIVE',
	CreatedAt DATETIME DEFAULT GETDATE()
);
GO

-- Customer Table
CREATE TABLE Customers (
	CustID VARCHAR(5) NOT NULL PRIMARY KEY,
	CustName varchar(100) NOT NULL,
	Phone varchar(20),
	Email varchar(200),
);
GO

-- Front End User Account Table
CREATE TABLE AppUsers (
	UserID INT IDENTITY(1,1) NOT NULL PRIMARY KEY, 
    -- Login Credentials
    Username VARCHAR(100) NOT NULL UNIQUE, 
    PasswordHash VARBINARY(256) NOT NULL, -- Store the securely hashed password
    UserType VARCHAR(10) NOT NULL CHECK (UserType IN ('EMPLOYEE', 'CUSTOMER')),
    
    -- Links to Profile Tables (One of these must be NULL)
    EmployeeID INT NULL, 
    CustID VARCHAR(5) NULL, 
    
    -- Security Fields
    LastLogin DATETIME NULL,
    IsActive BIT DEFAULT 1,

    -- Foreign Key Constraints (Ensure only one link is active)
    FOREIGN KEY (EmployeeID) REFERENCES Employees(EmployeeID),
    FOREIGN KEY (CustID) REFERENCES Customers(CustID),

    -- CONSTRAINT to enforce that a UserID links to EITHER an Employee OR a Customer, but not both, and not neither.
    CONSTRAINT CHK_One_Profile_Link 
        CHECK (
            (CASE WHEN EmployeeID IS NOT NULL THEN 1 ELSE 0 END + 
             CASE WHEN CustID IS NOT NULL THEN 1 ELSE 0 END) = 1
        )
);
GO

-- Database Administrations Table [DBA]
CREATE TABLE DatabaseAdministrations (
	EmployeeID INT NOT NULL PRIMARY KEY FOREIGN KEY REFERENCES Employees(EmployeeID),
	RoleInDepartment VARCHAR(50) CHECK (RoleInDepartment IN ('Manager', 'Team Member')),
	FullName VARCHAR(100) NOT NULL,
	Email NVARCHAR(100),
	Phone NVARCHAR(20) NOT NULL,
	Address NVARCHAR (255)
);
GO

-- Software Developers Team Table [SDEV]
CREATE TABLE SoftwareDevelopers (
	EmployeeID INT NOT NULL PRIMARY KEY FOREIGN KEY REFERENCES Employees(EmployeeID),
	RoleInDepartment VARCHAR(50) CHECK (RoleInDepartment IN ('Manager', 'Team Member')),
	FullName VARCHAR(100) NOT NULL,
	Email NVARCHAR(100),
	Phone NVARCHAR(20) NOT NULL,
	Address NVARCHAR (255)
);
GO

-- Accounting Team Table [ACC]
CREATE TABLE Accounting (
	EmployeeID INT NOT NULL PRIMARY KEY FOREIGN KEY REFERENCES Employees(EmployeeID),
	RoleInDepartment VARCHAR(50) CHECK (RoleInDepartment IN ('Manager', 'Team Member')),
	FullName VARCHAR(100) NOT NULL,
	Email NVARCHAR(100),
	Phone NVARCHAR(20) NOT NULL,
	Address NVARCHAR (255)
);
GO

-- Human Resources Team Table [HR]
CREATE TABLE HumanResources (
	EmployeeID INT NOT NULL PRIMARY KEY FOREIGN KEY REFERENCES Employees(EmployeeID),
	RoleInDepartment VARCHAR(50) CHECK (RoleInDepartment IN ('Manager', 'Team Member')),
	FullName VARCHAR(100) NOT NULL,
	Email NVARCHAR(100),
	Phone NVARCHAR(20) NOT NULL,
	Address NVARCHAR (255)
);
GO

-- Marketing Development Table [MKT]
CREATE TABLE MarketingDevelopment (
	EmployeeID INT NOT NULL PRIMARY KEY FOREIGN KEY REFERENCES Employees(EmployeeID),
	RoleInDepartment VARCHAR(50) CHECK (RoleInDepartment IN ('Manager', 'Team Member')),
	FullName VARCHAR(100) NOT NULL,
	Email NVARCHAR(100),
	Phone NVARCHAR(20) NOT NULL,
	Address NVARCHAR (255)
);
GO

-- Agents Table [AGENT]
CREATE TABLE Agents (
	AgentID INT NOT NULL PRIMARY KEY FOREIGN KEY REFERENCES Employees(EmployeeID),
	RoleInDepartment VARCHAR(50) CHECK (RoleInDepartment IN ('Manager', 'Team Member')),
	FullName VARCHAR(100) NOT NULL,
	Email NVARCHAR(100),
	Phone NVARCHAR(20) NOT NULL,
	Region NVARCHAR(200) NOT NULL CHECK (Region IN ('BukitJalil','Puchong','PetalingJaya','Klang')),
	Address NVARCHAR (255)
);
GO

-- Products Table
CREATE TABLE Products (
	ProductID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	ProductName NVARCHAR(100) NOT NULL,
	ProductDescription NVARCHAR(255),
	BasePrice DECIMAL(10,2) NOT NULL,
	SellingPrice DECIMAL(10,2) NOT NULL,
	CreatedAt DATETIME DEFAULT GETDATE()
);
GO

-- Sales (Invoice) Table
CREATE TABLE Sales (
	SalesID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	AgentID INT NOT NULL FOREIGN KEY REFERENCES Agents(AgentID),
	TotalAmount DECIMAL(10,2) NOT NULL,
	SaleDate DATETIME DEFAULT GETDATE(),
	PaymentStatus CHAR(10) CHECK (PaymentStatus IN ('PAID','PENDING','CANCELLED'))
);
GO

-- Sales Details Table
CREATE TABLE SalesDetails (
	SalesID INT IDENTITY(1,1) NOT NULL FOREIGN KEY REFERENCES Sales(SalesID),
	ProductID INT IDENTITY (1,1) NOT NULL FOREIGN KEY REFERENCES Products(ProductID),
	Quantity INT NOT NULL
); 
GO

-- Commission Table
CREATE TABLE Commission (
	CommissionID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	SalesID INT IDENTITY(1,1) NOT NULL FOREIGN KEY REFERENCES Sales(SalesID),
);
GO
